import os, sys, xbmc
from kodipopcorntime import plugin
from kodipopcorntime.utils import ensure_fanart
from kodipopcorntime.platform import PLATFORM
from kodipopcorntime.scrapers import yify
from kodipopcorntime.player import TorrentPlayer

if PLATFORM["os"] not in ["android", "linux", "windows", "darwin"] or PLATFORM["os"] == "android" and not PLATFORM["arch"] == "arm":
    plugin.notify(plugin.addon.getLocalizedString(30302) % PLATFORM, delay=15000)
    xbmc.log('Your system "%(os)s_%(arch)s" is not supported.' % PLATFORM, xbmc.LOGINFO)
    xbmc.log('Uname[os]: "%s"' % os.uname()[0], xbmc.LOGINFO)
    xbmc.log('Uname[host]: "%s"' % os.uname()[1], xbmc.LOGINFO)
    xbmc.log('Uname[release]: "%s"' % os.uname()[2], xbmc.LOGINFO)
    xbmc.log('Uname[version]: "%s"' % os.uname()[3], xbmc.LOGINFO)
    xbmc.log('Uname[machine]: "%s"' % os.uname()[4], xbmc.LOGINFO)
    sys.exit(0)

@plugin.route("/")
@ensure_fanart
def index():
    return yify.index()

@plugin.route("/play/<sub>/<uri>")
def play(uri, sub=None):
    if sub == "none":
        sub = None
    TorrentPlayer().init(uri, sub).loop()